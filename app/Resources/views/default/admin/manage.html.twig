{% extends ':default/admin:base.html.twig' %}

{% form_theme form ':default/admin/form:manage_fields.html.twig' %}

{% block styles %}
    <link rel="stylesheet" href="{{ asset('node_modules/bootstrap-datepicker/dist/css/bootstrap-datepicker.css') }}">
{% endblock %}
{% set entity = app.request.get('entity') %}

{% block page_heading %}{% endblock %}

{% block scripts %}
    <script src="{{ asset('admin/js/plugins/datapicker/bootstrap-datepicker.js') }}"></script>
    <script>
        $(document).ready(function () {
            var form = $('#form_{{ form.vars.name }}');

            {% if entity != 'event' %}
                form.append('<div style="margin-top: 20px;"><button class="btn btn-success" type="submit"><span class="fa fa-floppy-o"></span> Сохранить</button></div>')
            {% endif %}

            $('#banner_category').change(function () {

                var value = $(this).val(),
                    parent = $('#banner_category').parent();

                $('.banner-object-container').remove();

                if (value.length > 0) {
                    $.ajax({
                        url: '{{ path('admin.api.render_object_selector') }}',
                        method: 'post',
                        data: {
                            'category': value
                        },
                        success: function (data) {
                            $(parent).append(data);
                        }
                    })
                }
            });
            {% if object.object is defined and object.object is not empty %}
            $.ajax({
                url: '{{ path('admin.api.render_object_selector') }}',
                method: 'post',
                data: {
                    'category': '{{ object.category }}'
                },
                success: function (data) {
                    $('#banner_category').parent().append(data);
                    $('#banner_object').val('{{ object.object }}');
                }
            });
            {% endif %}
        });


        {% if entity != 'event' %}
            $('#{{ entity }}_seoTitle').liTranslit({
                elAlias: $('#{{ entity }}_slug')
            });
        {% endif %}

        $('.url-translit-generator').on('click', function (e) {
            $('#{{ entity }}_title').liTranslit({
                elAlias: $('#{{ entity }}_slug')
            });
            $('#{{ entity }}_title').unbind();
        });

        $('[data-field-type=datepicker-type]').datepicker({
            format: 'dd.mm.yyyy',
            autoclose: true
        });
    </script>


{% endblock %}

{% block content %}
{% endblock %}
