{% extends '::base.html.twig' %}

{% block title %} Календарь событий во Дворце Культуры Железнодорожников {% endblock %}

{% block stylesheets %}
    <link href="{{ asset('node_modules/fullcalendar/dist/fullcalendar.min.css') }}" rel="stylesheet">
    <link href="{{ asset('css/front/page/zaly.css') }}" rel="stylesheet">

{% endblock %}

{% block javascripts %}
    <script src="{{ asset('node_modules/fullcalendar/dist/fullcalendar.min.js') }}"></script>
    <script src="{{ asset('node_modules/fullcalendar/dist/locale/ru.js') }}"></script>
    <script>

        $(document).ready(function () {

            var date = new Date(),
                month = date.getMonth(),
                year = date.getFullYear(),
                limit = 5,
                monthFirstDay = new Date(year, month, 1),
                monthLastDay = new Date(year, month + 1, 0),
                apiUrl = '{{ path('api.load-events-by-month') }}',
                daysInMonth = new Date(date.getFullYear(), date.getMonth()+1, 0).getDate();

                console.log(monthFirstDay);

            $.ajax({
                url: apiUrl,
                method: 'post',
                data: {
                    'firstDay': $.datepicker.formatDate('yy-mm-dd', monthFirstDay),
                    'lastDay': $.datepicker.formatDate('yy-mm-dd', monthLastDay)
                },
                success: function (data) {
                    $('.event-list-row').append(data);
                }
            })
        });


        {#var events = [];#}

        {#{% for event in events %}#}

        {#var event = {#}
            {#start: '{{ event.eventDate | date('Y-m-d') }}',#}
            {#title: '{{ event.title }}',#}
            {#date: '{{ event.eventDate | date('d.m.Y') }}',#}
            {#time: '{{ event.eventTime | date('H:i') }}',#}
            {#url: '{{ path('event.details_page', {#}
                {#'event': event.id#}
            {#}) }}'#}
        {#};#}
        {#events.push(event);#}
        {#{% endfor %}#}


        {#$('#calendar').fullCalendar({#}
            {#defaultDate: $(this).fullCalendar('today'),#}
            {#events: events,#}
            {#eventBackgroundColor: '#F0DEBA',#}
            {#locale: 'ru',#}
            {#eventRender: function(event, element) {#}
                {#$(element)#}
                    {#.html(#}
                        {#'<div class="event-info-block">' +#}
                        {#'<p class="text-center"><a href="'+event.url+'" target="_blank" style="color: #D22630; font-size: 16px; text-decoration: underline">'+event.title+'</a></p>' +#}
                        {#'<p style="color: #D22630; font-size: 16px;"><span class="fa fa-calendar"></span> '+event.date+'</p>' +#}
                        {#'<p style="color: #D22630; font-size: 16px;"><span class="fa fa-clock-o"></span> '+event.time+'</p>' +#}
                        {#'</div>'#}
                {#);#}
            {#}#}
        {#});#}
    </script>
{% endblock %}

{% block content %}
    {% block main_banner_widget %}{{ parent() }}{% endblock %}

    <div class="space-fix-container"></div>

    {% block under_banner_text_widget %}
        <div class="container padding-0-100px" id="main-text-under-banner">
            <div class="text-center letter-spacing-1px banner-content-block">
                <p class="padding-0-100px">
                   Анонс мероприятий в Дворце Культуры Железнодорожников
                </p>
            </div>
        </div>
    {% endblock %}

    {% for event in events %}
        {% for file in event.files %}
            {% if file.isDefault == true %}
                {% set bgimg = file.name %}
            {% endif %}
        {% endfor %}
    {% endfor %}

    <div class="space-fix-container"></div>

    <div class="container padding-left-0 padding-right-0 halls-list-block event-list">
        <div class="row event-list-row">

        </div>
    </div>

{% endblock %}